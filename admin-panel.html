<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…ÙˆÙ‚Ø¹</title>
    <style>
        body {
            background: #0f172a;
            color: white;
            font-family: 'Tajawal', sans-serif;
            margin: 0;
        }
        .header {
            background: #1e293b;
            padding: 20px;
            text-align: center;
            border-bottom: 2px solid #38bdf8;
        }
        .container {
            display: flex;
            padding: 20px;
            gap: 20px;
        }
        .sidebar {
            width: 250px;
            background: #1e293b;
            padding: 20px;
            border-radius: 10px;
        }
        .content {
            flex: 1;
        }
        .file-list {
            max-height: 400px;
            overflow-y: auto;
        }
        .file-item {
            padding: 10px;
            background: #334155;
            margin: 5px 0;
            border-radius: 5px;
            cursor: pointer;
        }
        .file-item:hover {
            background: #475569;
        }
        .file-item.active {
            background: #38bdf8;
            color: black;
        }
        #editor {
            width: 100%;
            height: 500px;
            background: #1e293b;
            color: white;
            padding: 20px;
            border: 1px solid #475569;
            border-radius: 5px;
            font-family: monospace;
            font-size: 14px;
        }
        .buttons {
            margin-top: 20px;
            display: flex;
            gap: 10px;
        }
        button {
            padding: 12px 20px;
            background: #38bdf8;
            color: black;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        button:hover {
            background: #0ea5e9;
        }
        button.green {
            background: #10b981;
        }
        button.red {
            background: #ef4444;
            color: white;
        }
        .logout {
            margin-top: 30px;
        }
        .msg {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            display: none;
        }
        .success { background: #064e3b; color: #a7f3d0; }
        .error { background: #7f1d1d; color: #fecaca; }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ› ï¸ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… ØªØ¹Ø¯ÙŠÙ„ Ù…ÙˆÙ‚Ø¹ Web Forge</h1>
    </div>
    
    <div class="container">
        <div class="sidebar">
            <h3>ğŸ“ Ù…Ù„ÙØ§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹</h3>
            <div class="file-list" id="fileList">
                <!-- Ø§Ù„Ù…Ù„ÙØ§Øª ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
            </div>
            
            <div class="logout">
                <button class="red" onclick="logout()">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
            </div>
        </div>
        
        <div class="content">
            <h3>âœï¸ Ù…Ø­Ø±Ø± Ø§Ù„Ù†ØµÙˆØµ</h3>
            
            <div class="msg" id="message"></div>
            
            <textarea id="editor" placeholder="Ø§Ø®ØªØ± Ù…Ù„ÙØ§Ù‹ Ù„Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ø±ÙŠØ±..."></textarea>
            
            <div class="buttons">
                <button onclick="saveFile()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù</button>
                <button onclick="discardChanges()">âŒ ØªØ¬Ø§Ù‡Ù„ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
                <button class="green" onclick="previewFile()">ğŸ‘ï¸ Ù…Ø¹Ø§ÙŠÙ†Ø©</button>
                <button onclick="reloadFiles()">ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
            </div>
            
            <div style="margin-top: 20px; padding: 15px; background: #1e293b; border-radius: 5px;">
                <h4>ğŸ“Š Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù„Ù:</h4>
                <div id="fileInfo">Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù</div>
            </div>
        </div>
    </div>

    <script>
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¯Ø®ÙˆÙ„
        if(!localStorage.getItem('admin_login')) {
            window.location.href = 'admin-login.html';
        }
        
        let currentFile = '';
        let originalContent = '';
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª Ø¹Ù†Ø¯ Ø§Ù„Ø¨Ø¯Ø¡
        loadFiles();
        
        function loadFiles() {
            fetch('admin-api.php?action=list')
                .then(r => r.json())
                .then(files => {
                    let html = '';
                    files.forEach(file => {
                        html += `
                            <div class="file-item" onclick="loadFile('${file.path}')">
                                ${file.name}
                                <small style="color: #94a3b8; display: block;">${file.modified}</small>
                            </div>
                        `;
                    });
                    document.getElementById('fileList').innerHTML = html;
                });
        }
        
        function loadFile(filePath) {
            currentFile = filePath;
            
            fetch('admin-api.php?action=read&file=' + encodeURIComponent(filePath))
                .then(r => r.text())
                .then(content => {
                    document.getElementById('editor').value = content;
                    originalContent = content;
                    
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
                    document.querySelectorAll('.file-item').forEach(item => {
                        item.classList.remove('active');
                    });
                    event.target.classList.add('active');
                    
                    // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù„Ù
                    document.getElementById('fileInfo').innerHTML = `
                        <strong>Ø§Ù„Ù…Ù„Ù:</strong> ${filePath.split('/').pop()}<br>
                        <strong>Ø§Ù„Ø­Ø¬Ù…:</strong> ${content.length} Ø­Ø±Ù
                    `;
                    
                    showMessage('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù', 'success');
                });
        }
        
        function saveFile() {
            if(!currentFile) {
                showMessage('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø£ÙˆÙ„Ø§Ù‹', 'error');
                return;
            }
            
            let content = document.getElementById('editor').value;
            
            let formData = new FormData();
            formData.append('action', 'write');
            formData.append('file', currentFile);
            formData.append('content', content);
            
            fetch('admin-api.php', {
                method: 'POST',
                body: formData
            })
            .then(r => r.text())
            .then(result => {
                showMessage('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­', 'success');
                originalContent = content;
            });
        }
        
        function discardChanges() {
            if(confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ¬Ø§Ù‡Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØºÙŠÙŠØ±Ø§ØªØŸ')) {
                document.getElementById('editor').value = originalContent;
                showMessage('ØªÙ… ØªØ¬Ø§Ù‡Ù„ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª', 'success');
            }
        }
        
        function previewFile() {
            let content = document.getElementById('editor').value;
            let win = window.open('', '_blank');
            win.document.write(content);
        }
        
        function reloadFiles() {
            loadFiles();
            showMessage('ØªÙ… ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù„ÙØ§Øª', 'success');
        }
        
        function logout() {
            localStorage.removeItem('admin_login');
            window.location.href = 'admin-login.html';
        }
        
        function showMessage(text, type) {
            let msg = document.getElementById('message');
            msg.textContent = text;
            msg.className = 'msg ' + type;
            msg.style.display = 'block';
            
            setTimeout(() => {
                msg.style.display = 'none';
            }, 3000);
        }
        
        // ØªØ­Ø°ÙŠØ± Ø¹Ù†Ø¯ Ù…ØºØ§Ø¯Ø±Ø© Ø§Ù„ØµÙØ­Ø© Ù…Ø¹ ØªØºÙŠÙŠØ±Ø§Øª ØºÙŠØ± Ù…Ø­ÙÙˆØ¸Ø©
        window.onbeforeunload = function() {
            if(document.getElementById('editor').value !== originalContent) {
                return 'Ù„Ø¯ÙŠÙƒ ØªØºÙŠÙŠØ±Ø§Øª ØºÙŠØ± Ù…Ø­ÙÙˆØ¸Ø©!';
            }
        };
    </script>
</body>
</html>
